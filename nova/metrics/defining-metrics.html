<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Defining Metrics | CourseWire Docs</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Informing about educations">
    <meta name="theme-color" content="#c87f2f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/coursewire/assets/css/0.styles.bfc8dd69.css" as="style"><link rel="preload" href="/coursewire/assets/js/app.02511102.js" as="script"><link rel="preload" href="/coursewire/assets/js/2.fbd24a80.js" as="script"><link rel="preload" href="/coursewire/assets/js/36.bfb957fe.js" as="script"><link rel="prefetch" href="/coursewire/assets/js/10.4212c2f9.js"><link rel="prefetch" href="/coursewire/assets/js/11.3c48ff1c.js"><link rel="prefetch" href="/coursewire/assets/js/12.8c4af0eb.js"><link rel="prefetch" href="/coursewire/assets/js/13.bf842588.js"><link rel="prefetch" href="/coursewire/assets/js/14.37b2191d.js"><link rel="prefetch" href="/coursewire/assets/js/15.c876d26f.js"><link rel="prefetch" href="/coursewire/assets/js/16.073345a7.js"><link rel="prefetch" href="/coursewire/assets/js/17.e24f1dd7.js"><link rel="prefetch" href="/coursewire/assets/js/18.8bfdb26b.js"><link rel="prefetch" href="/coursewire/assets/js/19.ffc8cf96.js"><link rel="prefetch" href="/coursewire/assets/js/20.36a0871b.js"><link rel="prefetch" href="/coursewire/assets/js/21.35f26c2d.js"><link rel="prefetch" href="/coursewire/assets/js/22.e5eca7c6.js"><link rel="prefetch" href="/coursewire/assets/js/23.585f7050.js"><link rel="prefetch" href="/coursewire/assets/js/24.1eb91c63.js"><link rel="prefetch" href="/coursewire/assets/js/25.b87544a9.js"><link rel="prefetch" href="/coursewire/assets/js/26.ca38d820.js"><link rel="prefetch" href="/coursewire/assets/js/27.cdd47a7e.js"><link rel="prefetch" href="/coursewire/assets/js/28.910457fd.js"><link rel="prefetch" href="/coursewire/assets/js/29.c1ae8d42.js"><link rel="prefetch" href="/coursewire/assets/js/3.8bf11098.js"><link rel="prefetch" href="/coursewire/assets/js/30.5cc41175.js"><link rel="prefetch" href="/coursewire/assets/js/31.9e2127cc.js"><link rel="prefetch" href="/coursewire/assets/js/32.5397ea66.js"><link rel="prefetch" href="/coursewire/assets/js/33.45080a30.js"><link rel="prefetch" href="/coursewire/assets/js/34.6e3f0c23.js"><link rel="prefetch" href="/coursewire/assets/js/35.ddd28f5a.js"><link rel="prefetch" href="/coursewire/assets/js/37.52edfd39.js"><link rel="prefetch" href="/coursewire/assets/js/38.0c7c9bb2.js"><link rel="prefetch" href="/coursewire/assets/js/39.134dd667.js"><link rel="prefetch" href="/coursewire/assets/js/4.c93ddc9d.js"><link rel="prefetch" href="/coursewire/assets/js/40.0321689a.js"><link rel="prefetch" href="/coursewire/assets/js/41.685503da.js"><link rel="prefetch" href="/coursewire/assets/js/42.73b1c1d1.js"><link rel="prefetch" href="/coursewire/assets/js/43.ff4aa68f.js"><link rel="prefetch" href="/coursewire/assets/js/44.2cb09a15.js"><link rel="prefetch" href="/coursewire/assets/js/45.9071b634.js"><link rel="prefetch" href="/coursewire/assets/js/46.691acbad.js"><link rel="prefetch" href="/coursewire/assets/js/47.09900fe0.js"><link rel="prefetch" href="/coursewire/assets/js/48.31c05462.js"><link rel="prefetch" href="/coursewire/assets/js/49.3eb88337.js"><link rel="prefetch" href="/coursewire/assets/js/5.acf75b03.js"><link rel="prefetch" href="/coursewire/assets/js/50.be69d7ce.js"><link rel="prefetch" href="/coursewire/assets/js/51.d6025ff9.js"><link rel="prefetch" href="/coursewire/assets/js/52.afab6d12.js"><link rel="prefetch" href="/coursewire/assets/js/6.a7a1e44e.js"><link rel="prefetch" href="/coursewire/assets/js/7.cf5f8500.js"><link rel="prefetch" href="/coursewire/assets/js/8.80f7340e.js"><link rel="prefetch" href="/coursewire/assets/js/9.749dd9d2.js">
    <link rel="stylesheet" href="/coursewire/assets/css/0.styles.bfc8dd69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coursewire/" class="home-link router-link-active"><!----> <span class="site-name">CourseWire Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coursewire/specification/" class="nav-link">
  Specification
</a></div><div class="nav-item"><a href="/coursewire/setup/" class="nav-link">
  Setup
</a></div><div class="nav-item"><a href="/coursewire/style-guide/" class="nav-link">
  Style guide
</a></div><div class="nav-item"><a href="/coursewire/nova/" class="nav-link router-link-active">
  Nova
</a></div><div class="nav-item"><a href="/coursewire/forge/" class="nav-link">
  Forge
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/coursewire/specification/" class="nav-link">
  Specification
</a></div><div class="nav-item"><a href="/coursewire/setup/" class="nav-link">
  Setup
</a></div><div class="nav-item"><a href="/coursewire/style-guide/" class="nav-link">
  Style guide
</a></div><div class="nav-item"><a href="/coursewire/nova/" class="nav-link router-link-active">
  Nova
</a></div><div class="nav-item"><a href="/coursewire/forge/" class="nav-link">
  Forge
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nova</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coursewire/nova/" aria-current="page" class="sidebar-link">Laravel Nova</a></li><li><a href="/coursewire/nova/actions/defining-actions.html" class="sidebar-link">Defining Actions</a></li><li><a href="/coursewire/nova/actions/registering-actions.html" class="sidebar-link">Registering Actions</a></li><li><a href="/coursewire/nova/customization/assets.html" class="sidebar-link">Assets</a></li><li><a href="/coursewire/nova/customization/cards.html" class="sidebar-link">Cards</a></li><li><a href="/coursewire/nova/customization/dashboards.html" class="sidebar-link">Dashboards</a></li><li><a href="/coursewire/nova/customization/fields.html" class="sidebar-link">Fields</a></li><li><a href="/coursewire/nova/customization/frontend.html" class="sidebar-link">CSS / JavaScript</a></li><li><a href="/coursewire/nova/customization/localization.html" class="sidebar-link">Localization</a></li><li><a href="/coursewire/nova/customization/resource-tools.html" class="sidebar-link">Resource Tools</a></li><li><a href="/coursewire/nova/customization/stubs.html" class="sidebar-link">Stubs</a></li><li><a href="/coursewire/nova/customization/themes.html" class="sidebar-link">Themes</a></li><li><a href="/coursewire/nova/customization/tools.html" class="sidebar-link">Tools</a></li><li><a href="/coursewire/nova/dashboard/metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/coursewire/nova/dashboard/tools.html" class="sidebar-link">Tools</a></li><li><a href="/coursewire/nova/filters/defining-filters.html" class="sidebar-link">Defining Filters</a></li><li><a href="/coursewire/nova/filters/registering-filters.html" class="sidebar-link">Registering Filters</a></li><li><a href="/coursewire/nova/lenses/defining-lenses.html" class="sidebar-link">Defining Lenses</a></li><li><a href="/coursewire/nova/lenses/registering-lenses.html" class="sidebar-link">Registering Lenses</a></li><li><a href="/coursewire/nova/metrics/defining-metrics.html" aria-current="page" class="active sidebar-link">Defining Metrics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coursewire/nova/metrics/defining-metrics.html#value-metrics" class="sidebar-link">Value Metrics</a></li><li class="sidebar-sub-header"><a href="/coursewire/nova/metrics/defining-metrics.html#trend-metrics" class="sidebar-link">Trend Metrics</a></li><li class="sidebar-sub-header"><a href="/coursewire/nova/metrics/defining-metrics.html#partition-metrics" class="sidebar-link">Partition Metrics</a></li><li class="sidebar-sub-header"><a href="/coursewire/nova/metrics/defining-metrics.html#caching" class="sidebar-link">Caching</a></li></ul></li><li><a href="/coursewire/nova/metrics/registering-metrics.html" class="sidebar-link">Registering Metrics</a></li><li><a href="/coursewire/nova/nova-js/" class="sidebar-link">Overview</a></li><li><a href="/coursewire/nova/nova-js/event-bus.html" class="sidebar-link">Event Bus</a></li><li><a href="/coursewire/nova/nova-js/methods.html" class="sidebar-link">Methods</a></li><li><a href="/coursewire/nova/nova-js/properties.html" class="sidebar-link">Properties</a></li><li><a href="/coursewire/nova/resources/" class="sidebar-link">The Basics</a></li><li><a href="/coursewire/nova/resources/authorization.html" class="sidebar-link">Authorization</a></li><li><a href="/coursewire/nova/resources/date-fields.html" class="sidebar-link">Date Fields</a></li><li><a href="/coursewire/nova/resources/fields.html" class="sidebar-link">Fields</a></li><li><a href="/coursewire/nova/resources/file-fields.html" class="sidebar-link">File Fields</a></li><li><a href="/coursewire/nova/resources/relationships.html" class="sidebar-link">Relationships</a></li><li><a href="/coursewire/nova/resources/validation.html" class="sidebar-link">Validation</a></li><li><a href="/coursewire/nova/search/global-search.html" class="sidebar-link">Global Search</a></li><li><a href="/coursewire/nova/search/scout-integration.html" class="sidebar-link">Scout Integration</a></li><li><a href="/coursewire/nova/installation.html" class="sidebar-link">Installation</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="defining-metrics"><a href="#defining-metrics" class="header-anchor">#</a> Defining Metrics</h1> <p></p><div class="table-of-contents"><ul><li><a href="#value-metrics">Value Metrics</a><ul><li><a href="#value-query-types">Value Query Types</a></li><li><a href="#value-result-formatting">Value Result Formatting</a></li><li><a href="#value-ranges">Value Ranges</a></li><li><a href="#zero-result-values">Zero Result Values</a></li><li><a href="#manually-building-value-results">Manually Building Value Results</a></li></ul></li><li><a href="#trend-metrics">Trend Metrics</a><ul><li><a href="#trend-query-types">Trend Query Types</a></li><li><a href="#trend-ranges">Trend Ranges</a></li><li><a href="#formatting-the-trend-value">Formatting The Trend Value</a></li><li><a href="#displaying-the-current-value">Displaying The Current Value</a></li><li><a href="#manually-building-trend-results">Manually Building Trend Results</a></li></ul></li><li><a href="#partition-metrics">Partition Metrics</a><ul><li><a href="#partition-query-types">Partition Query Types</a></li><li><a href="#customizing-partition-labels">Customizing Partition Labels</a></li><li><a href="#customizing-partition-colors">Customizing Partition Colors</a></li><li><a href="#manually-building-partition-results">Manually Building Partition Results</a></li></ul></li><li><a href="#caching">Caching</a></li></ul></div><p></p> <p>Nova metrics allow you to quickly gain insight on key business indicators for your application. For example, you may define a metric to display the total number of users added to your application per day, or the amount of weekly sales.</p> <p>Nova offers three types of built-in metrics: value, trend, and partition. We'll examine each type of metric and demonstrate their usage below.</p> <h2 id="value-metrics"><a href="#value-metrics" class="header-anchor">#</a> Value Metrics</h2> <p>Value metrics display a single value and, if desired, its change compared to a previous time interval. For example, a value metric might display the total number of users created in the last thirty days compared with the previous thirty days:</p> <p><img src="img/value.png" alt="Value Metric"></p> <p>Value metrics may be generated using the <code>nova:value</code> Artisan command. By default, all new metrics will be placed in the <code>app/Nova/Metrics</code> directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan nova:value NewUsers
</code></pre></div><p>Once your value metric class has been generated, you're ready to customize it. Each value metric class contains a <code>calculate</code> method. This method should return a <code>Laravel\Nova\Metrics\ValueResult</code> object. Don't worry, Nova ships with a variety of helpers for quickly generating results.</p> <p>In this example, we are using the <code>count</code> helper, which will automatically perform a <code>count</code> query against the specified Eloquent model for the selected range, as well as automatically retrieve the count for the &quot;previous&quot; range:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Nova<span class="token punctuation">\</span>Metrics</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Nova<span class="token punctuation">\</span>Metrics<span class="token punctuation">\</span>Value</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">NewUsers</span> <span class="token keyword">extends</span> <span class="token class-name">Value</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Calculate the value of the metric.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the ranges available for the metric.
     *
     * @return array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ranges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token number">30</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'30 Days'</span><span class="token punctuation">,</span>
            <span class="token number">60</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'60 Days'</span><span class="token punctuation">,</span>
            <span class="token number">365</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'365 Days'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'TODAY'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Today'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'MTD'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Month To Date'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'QTD'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Quarter To Date'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'YTD'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Year To Date'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the URI key for the metric.
     *
     * @return string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">uriKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token single-quoted-string string">'new-users'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="value-query-types"><a href="#value-query-types" class="header-anchor">#</a> Value Query Types</h3> <p>Value metrics don't just ship with a <code>count</code> helper. You may also use a variety of other aggregate functions when building your metric.</p> <h4 id="average"><a href="#average" class="header-anchor">#</a> Average</h4> <p>The <code>average</code> method may be used to calculate the average of a given column compared to the previous time interval / range:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'word_count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sum"><a href="#sum" class="header-anchor">#</a> Sum</h4> <p>The <code>sum</code> method may be used to calculate the sum of a given column compared to the previous time interval / range:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="max"><a href="#max" class="header-anchor">#</a> Max</h4> <p>The <code>max</code> method may be used to calculate the maximum of a given column compared to the previous time interval / range:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="min"><a href="#min" class="header-anchor">#</a> Min</h4> <p>The <code>min</code> method may be used to calculate the minimum of a given column compared to the previous time interval / range:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="value-result-formatting"><a href="#value-result-formatting" class="header-anchor">#</a> Value Result Formatting</h3> <p>You can add a prefix and/or suffix to the Value metric's result by calling the <code>prefix</code> and <code>suffix</code> methods when returning the <code>ValueResult</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">prefix</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'$'</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">suffix</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'per unit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may also use the <code>currency</code> method to specify the prefix for the result. By default the currency symbol will be <code>$</code>, but you may also pass in your own symbol:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">currency</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'£'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To customize the display format, you can use the <code>format</code> method. The format must be a format supported by <a href="http://numbrojs.com/old-format.html" target="_blank" rel="noopener noreferrer">Numbro<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'0,0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="value-ranges"><a href="#value-ranges" class="header-anchor">#</a> Value Ranges</h3> <p>Every value metric class contains a <code>ranges</code> method. This method determines the ranges that will be available in the value metric's range selection menu. The array's keys determine the number of days that should be included in the query, while the values determine the &quot;human readable&quot; text that will be placed in the range selection menu. Of course, you are not required to define any ranges at all:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * Get the ranges available for the metric.
 *
 * @return array
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ranges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token number">5</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'5 Days'</span><span class="token punctuation">,</span>
        <span class="token number">10</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'10 Days'</span><span class="token punctuation">,</span>
        <span class="token number">15</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'15 Days'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'TODAY'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Today'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'MTD'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Month To Date'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'QTD'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Quarter To Date'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'YTD'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Year To Date'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">TODAY / MTD / QTD / YTD Range Keys</p> <p>You may customize these ranges to suit your needs; however, if you are using the built-in &quot;Today&quot;, &quot;Month To Date&quot;, &quot;Quarter To Date&quot;, or &quot;Year To Date&quot; ranges, you should not change their keys.</p></div> <h3 id="zero-result-values"><a href="#zero-result-values" class="header-anchor">#</a> Zero Result Values</h3> <p>By default, Nova will handle results of <code>0</code> as a result containing no data. This may not always be correct, which is why you can use the <code>allowZeroResult</code> method to prevent this from happening:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allowZeroResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="manually-building-value-results"><a href="#manually-building-value-results" class="header-anchor">#</a> Manually Building Value Results</h3> <p>If you are not able to use the included query helpers for building your value metric, you may manually provide the final values to the metric using the <code>result</code> and <code>previous</code> methods:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">previous</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="trend-metrics"><a href="#trend-metrics" class="header-anchor">#</a> Trend Metrics</h2> <p>Trend metrics display values over time via a line chart. For example, a trend metric might display the number of new users created per day over the previous thirty days:</p> <p><img src="img/trend.png" alt="Trend Metric"></p> <p>Trend metrics may be generated using the <code>nova:trend</code> Artisan command. By default, all new metrics will be placed in the <code>app/Nova/Metrics</code> directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan nova:trend UsersPerDay
</code></pre></div><p>Once your trend metric class has been generated, you're ready to customize it. Each trend metric class contains a <code>calculate</code> method. This method should return a <code>Laravel\Nova\Metrics\TrendResult</code> object. Don't worry, Nova ships with a variety of helpers for quickly generating results.</p> <p>In this example, we are using the <code>countByDays</code> helper, which will automatically perform a <code>count</code> query against the specified Eloquent model for the selected range and for the selected interval unit (in this case, days):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Nova<span class="token punctuation">\</span>Metrics</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Nova<span class="token punctuation">\</span>Metrics<span class="token punctuation">\</span>Trend</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UsersPerDay</span> <span class="token keyword">extends</span> <span class="token class-name">Trend</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Calculate the value of the metric.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the ranges available for the metric.
     *
     * @return array
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ranges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token number">30</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'30 Days'</span><span class="token punctuation">,</span>
            <span class="token number">60</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'60 Days'</span><span class="token punctuation">,</span>
            <span class="token number">90</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'90 Days'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the URI key for the metric.
     *
     * @return string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">uriKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token single-quoted-string string">'users-per-day'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="trend-query-types"><a href="#trend-query-types" class="header-anchor">#</a> Trend Query Types</h3> <p>Trend metrics don't just ship with a <code>countByDays</code> helper. You may also use a variety of other aggregate functions and time intervals when building your metric.</p> <h4 id="count"><a href="#count" class="header-anchor">#</a> Count</h4> <p>The <code>count</code> methods may be used to calculate the count of a given column over time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByMonths</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByWeeks</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByHours</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByMinutes</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="average-2"><a href="#average-2" class="header-anchor">#</a> Average</h4> <p>The <code>average</code> methods may be used to calculate the average of a given column over time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">averageByMonths</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'word_count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">averageByWeeks</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'word_count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">averageByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'word_count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">averageByHours</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'word_count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">averageByMinutes</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'word_count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sum-2"><a href="#sum-2" class="header-anchor">#</a> Sum</h4> <p>The <code>sum</code> methods may be used to calculate the sum of a given column over time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sumByMonths</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sumByWeeks</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sumByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sumByHours</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sumByMinutes</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="max-2"><a href="#max-2" class="header-anchor">#</a> Max</h4> <p>The <code>max</code> methods may be used to calculate the maximum of a given column over time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">maxByMonths</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">maxByWeeks</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">maxByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">maxByHours</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">maxByMinutes</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="min-2"><a href="#min-2" class="header-anchor">#</a> Min</h4> <p>The <code>min</code> methods may be used to calculate the minimum of a given column over time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">minByMonths</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">minByWeeks</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">minByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">minByHours</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">minByMinutes</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="showing-the-sum-of-values"><a href="#showing-the-sum-of-values" class="header-anchor">#</a> Showing the sum of values</h4> <p>By default, Nova only displays the last value of a Trend metric. You may wish to show a total count of the trend. You can do this by specifying the <code>showSumValue</code> method when returning your values from a Metric:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">UsersPerDay</span> <span class="token keyword">extends</span> <span class="token class-name">Trend</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Calculate the value of the metric.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">showSumValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="trend-ranges"><a href="#trend-ranges" class="header-anchor">#</a> Trend Ranges</h3> <p>Every trend metric class contains a <code>ranges</code> method. This method determines the ranges that will be available in the trend metric's range selection menu. The array's keys determine the number of time interval units (months, weeks, days, etc.) that should be included in the query, while the values determine the &quot;human readable&quot; text that will be placed in the range selection menu. Of course, you are not required to define any ranges at all:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * Get the ranges available for the metric.
 *
 * @return array
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ranges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token number">5</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'5 Days'</span><span class="token punctuation">,</span>
        <span class="token number">10</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'10 Days'</span><span class="token punctuation">,</span>
        <span class="token number">15</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'15 Days'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="formatting-the-trend-value"><a href="#formatting-the-trend-value" class="header-anchor">#</a> Formatting The Trend Value</h3> <p>Sometimes you may wish to add a prefix or suffix to the trend values. To accomplish this, you may use the <code>prefix</code> and <code>suffix</code> methods:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">prefix</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'$'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If your trend metric is displaying a monetary value, you may use the <code>dollars</code> and <code>euros</code> short-cut methods for quickly prefixing a Dollar or Euro sign to the trend values:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">dollars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="displaying-the-current-value"><a href="#displaying-the-current-value" class="header-anchor">#</a> Displaying The Current Value</h3> <p>Sometimes, you may wish to emphasize the value for the latest time interval. For example, in this screenshot, six users have been created during the last day:</p> <p><img src="img/latest-value.png" alt="Latest Value"></p> <p>To accomplish this, you may use the <code>showLatestValue</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">showLatestValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You may customize the display format using the <code>format</code> method. The format must be a format supported by <a href="http://numeraljs.com/#format" target="_blank" rel="noopener noreferrer">Numeral.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">countByDays</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">showLatestValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'0,0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="manually-building-trend-results"><a href="#manually-building-trend-results" class="header-anchor">#</a> Manually Building Trend Results</h3> <p>If you are not able to use the included query helpers for building your trend metric, you may manually construct the <code>Laravel\Nova\Metrics\TrendResult</code> object and return it from your metric's <code>calculate</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TrendResult</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">trend</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'July 1'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'July 2'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">150</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'July 3'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">200</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="partition-metrics"><a href="#partition-metrics" class="header-anchor">#</a> Partition Metrics</h2> <p>Partition metrics displays a pie chart of values. For example, a partition metric might display the total number of users for each billing plan offered by your application:</p> <p><img src="img/partition.png" alt="Partition Metric"></p> <p>Partition metrics may be generated using the <code>nova:partition</code> Artisan command. By default, all new metrics will be placed in the <code>app/Nova/Metrics</code> directory:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>php artisan nova:partition UsersPerPlan
</code></pre></div><p>Once your partition metric class has been generated, you're ready to customize it. Each partition metric class contains a <code>calculate</code> method. This method should return a <code>Laravel\Nova\Metrics\PartitionResult</code> object. Don't worry, Nova ships with a variety of helpers for quickly generating results.</p> <p>In this example, we are using the <code>count</code> helper, which will automatically perform a <code>count</code> query against the specified Eloquent model and retrieve the number of models belonging to each distinct value of your specified &quot;group by&quot; column:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Nova<span class="token punctuation">\</span>Metrics</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Nova<span class="token punctuation">\</span>Metrics<span class="token punctuation">\</span>Partition</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UsersPerPlan</span> <span class="token keyword">extends</span> <span class="token class-name">Partition</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Calculate the value of the metric.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return mixed
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'stripe_plan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Get the URI key for the metric.
     *
     * @return string
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">uriKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token single-quoted-string string">'users-by-plan'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="partition-query-types"><a href="#partition-query-types" class="header-anchor">#</a> Partition Query Types</h3> <p>Partition metrics don't just ship with a <code>count</code> helper. You may also use a variety of other aggregate functions when building your metric.</p> <h4 id="average-3"><a href="#average-3" class="header-anchor">#</a> Average</h4> <p>The <code>average</code> method may be used to calculate the average of a given column within distinct groups. For example, the following call to the <code>average</code> method will display a pie chart with the average order price for each department of the company:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sum-3"><a href="#sum-3" class="header-anchor">#</a> Sum</h4> <p>The <code>sum</code> method may be used to calculate the sum of a given column within distinct groups. For example, the following call to the <code>sum</code> method will display a pie chart with the sum of all order prices for each department of the company:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="max-3"><a href="#max-3" class="header-anchor">#</a> Max</h4> <p>The <code>max</code> method may be used to calculate the max of a given column within distinct groups. For example, the following call to the <code>max</code> method will display a pie chart with the maximum order price for each department of the company:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="min-3"><a href="#min-3" class="header-anchor">#</a> Min</h4> <p>The <code>min</code> method may be used to calculate the min of a given column within distinct groups. For example, the following call to the <code>min</code> method will display a pie chart with the minimum order price for each department of the company:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'price'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="customizing-partition-labels"><a href="#customizing-partition-labels" class="header-anchor">#</a> Customizing Partition Labels</h3> <p>Often, the column values that divide your partition metrics into groups will be simple keys, and not something that is &quot;human friendly&quot;. Or, if you are displaying a partition metric grouped by a column that is a boolean, Nova will display your group labels as &quot;0&quot; and &quot;1&quot;. For this reason, Nova allows you to provide a Closure that formats the label into something more readable:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * Calculate the value of the metric.
 *
 * @param  \Illuminate\Http\Request  $request
 * @return mixed
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'stripe_plan'</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token constant">null</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token single-quoted-string string">'None'</span><span class="token punctuation">;</span>
                    <span class="token keyword">default</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token function">ucfirst</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="customizing-partition-colors"><a href="#customizing-partition-colors" class="header-anchor">#</a> Customizing Partition Colors</h3> <p>By default, Nova will choose the colors used in a partition metric. Sometimes, you may wish to change these to match the type of data they represent. To do this you can call the <code>colors</code> method when returning your value from the metric:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * Calculate the value of the metric.
 *
 * @param  \Illuminate\Http\Request  $request
 * @return mixed
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// This metric has `audio`, `video`, and `photo` types</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'type'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">colors</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'audio'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'#6ab04c'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'video'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'rgb(72,52,212)'</span><span class="token punctuation">,</span>
        <span class="token comment">// photo will use the default color from Nova</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="manually-building-partition-results"><a href="#manually-building-partition-results" class="header-anchor">#</a> Manually Building Partition Results</h3> <p>If you are not able to use the included query helpers for building your partition metric, you may manually provide the final values to the metric using the <code>result</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'Group 1'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'Group 2'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'Group 3'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">300</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="caching"><a href="#caching" class="header-anchor">#</a> Caching</h2> <p>Occasionally the calculation of a metric's values can be slow and expensive. For this reason, all Nova metrics contain a <code>cacheFor</code> method which allows you to specify the duration the metric result should be cached:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * Determine for how many minutes the metric should be cached.
 *
 * @return  \DateTimeInterface|\DateInterval|float|int
 */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">cacheFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/24/2020, 11:08:49 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/coursewire/nova/lenses/registering-lenses.html" class="prev">
        Registering Lenses
      </a></span> <span class="next"><a href="/coursewire/nova/metrics/registering-metrics.html">
        Registering Metrics
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/coursewire/assets/js/app.02511102.js" defer></script><script src="/coursewire/assets/js/2.fbd24a80.js" defer></script><script src="/coursewire/assets/js/36.bfb957fe.js" defer></script>
  </body>
</html>
